<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>📸 Snap to Sheet</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <style>
    body { font-family:'Segoe UI'; background:linear-gradient(to right,#00c6ff,#0072ff); color:#fff; text-align:center; padding:2rem; margin:0 }
    .card { background:rgba(255,255,255,0.1); border-radius:12px; padding:2rem; max-width:400px; margin:auto; box-shadow:0 8px 16px rgba(0,0,0,0.2) }
    input, button { margin:1rem 0; padding:.75rem; width:100%; border:none; border-radius:8px; font-size:1rem; font-weight:bold }
    input { background:#fff; color:#333 }
    button { background:#fff; color:#0072ff; cursor:pointer }
    button:hover { background:#e0e0e0 }
    #status { margin-top:1rem }
    .spinner { display:none; margin:1rem auto; width:40px; height:40px; border:4px solid #fff; border-top:4px solid #0072ff; border-radius:50%; animation:spin 1s linear infinite }
    @keyframes spin { to { transform:rotate(360deg) } }
  </style>
</head>
<body>
  <h1>📸 Snap to Sheet</h1>
  <div class="card">
    <input type="file" accept="image/*" capture="environment" id="fileInput" />
    <button id="uploadBtn">Upload (DEBUG)</button>
    <div class="spinner" id="spinner"></div>
    <div id="status"></div>
  </div>

  <!-- hidden iframe to catch the POST -->
  <iframe name="uploadTarget" style="display:none;"></iframe>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycby8cpsiDdLclfcR9bHULOcbOZUvrXI56qWoKAQNbyhmGqKu3J5T8xOSLSfOylLWPI3dWg/exec"; // ← replace with your exec URL

    const fileInput = document.getElementById('fileInput');
    const uploadBtn = document.getElementById('uploadBtn');
    const spinner   = document.getElementById('spinner');
    const status    = document.getElementById('status');

    // Build a hidden form once
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = WEB_APP_URL;
    form.target = 'uploadTarget';
    form.style.display = 'none';
    const imageField = document.createElement('input');
    imageField.type = 'hidden';
    imageField.name = 'image';
    form.appendChild(imageField);
    document.body.appendChild(form);

    uploadBtn.addEventListener('click', () => {
      const file = fileInput.files[0];
      if (!file) {
        return status.textContent = "⚠️ Please select a photo.";
      }

      spinner.style.display = 'block';
      status.textContent = "⏳ Encoding & sending…";

      const reader = new FileReader();
      reader.onload = () => {
        // strip prefix and set hidden field
        imageField.value = reader.result.replace(/^data:image\/\w+;base64,/, "");

        // submit into the iframe
        form.submit();
      };
      reader.readAsDataURL(file);
    });

    // When iframe finishes loading, report success
    document.querySelector('iframe[name="uploadTarget"]')
      .addEventListener('load', () => {
        spinner.style.display = 'none';
        status.textContent = "✅ Upload complete! Check the Sheet for DEBUG row.";
      });
  </script>
</body>
</html>
